# SupplySleuth

- это комплексное решение для автоматизации скачивания, анализа и уведомления о государственных закупках через площадку ЕИС. Проект использует FTP для получения данных в формате XML, обрабатывает их для извлечения необходимой информации, структурирует данные и переводит их в базу данных PostgreSQL. Это позволяет пользователям проводить глубокий анализ закупок по различным параметрам, включая заказчика, подрядчика, проектировщика и регион. Система уведомлений информирует пользователей о новых торгах по электронной почте или через телеграм-канал и предоставляет возможность поиска торгов по ключевым фразам в документации.

## Особенности

- Автоматическое скачивание данных с площадки ЕИС через FTP.
- Обработка и структурирование данных из XML-разметки.
- Интеграция с базой данных PostgreSQL для хранения и анализа данных.
- Расширенный поиск и анализ закупок по множеству параметров.
- Система уведомлений о новых закупках через электронную почту и телеграм.
- Поиск по фразам в документации торгов.

## Начало работы

Для начала работы с TenderStreamline следуйте инструкциям ниже.

Данные инструкции помогут вам получить копию проекта и запустить его на локальной машине для разработки и тестирования.


### Предварительные требования

Перед установкой убедитесь, что у вас установлены следующие инструменты:
- Python 3.8+
- PostgreSQL
- FTP клиент
- 
TODO--> необходимо доработать этот раздел позже

### Установка
1. Клонируйте репозиторий с GitHub:
    ```bash
    git clone <url_репозитория>
    ```
   
2. Установите зависимости:

   Для работы с проектом вам понадобится установить необходимые зависимости. Сделать это можно следующим образом:


3. Установите необходимые зависимости, используя `pip` и файл `requirements.txt`, который находится в корне проекта:
    ```bash
    pip install -r requirements.txt
    ```
   Это установит все необходимые библиотеки, указанные в файле requirements.txt, включая:

- loguru == 0.7.2
- requests == 2.31.0
- beautifulsoup4 == 4.12.2
- tqdm == 4.66.2
python-dotenv == 1.0.1
psycopg2 == 2.9.9

   Теперь вы готовы к использованию проекта!

## Использование

1. Описание и использование параметров для настройки программы:

## Модуль config.py

Содержит в себе переменные, которые настраиваются в соответствии с вашими потребностями
и предоставляют гибкость для работы приложения в различных условиях.

### Класс
```python
ConfigSetting
```
Конфигурационные параметры:

- xml_zip_local_directory: путь до папки, содержащей ZIP архивы документов XML (или куда они скачиваются);
- xml_unpacked_local_directory: путь до папки для распакованных документов XML (или куда они загружаются);
- zip_archive_local_directory: путь до папки, содержащей ZIP архивы документов, скачанных с ЕИС
(или куда они скачиваются);
- unpacked_output_local_directory: путь до папки для распакованных ZIP архивов документов PDF
(или куда они загружаются);
- inn_set: набор ИНН для первичного условия парсинга файлов XML;
- set_okpd_2: набор данных по ОКПД для первичного условия парасинга файлов XML;
- start_date: дата, начиная с которой скачиваем архивы с FTP ЕИС.


Пример использования:
Использование

Для получения значений конфигурационных параметров используйте <u>статический метод</u>
- get_config_value.

Этот метод принимает ключ конфигурационной переменной в качестве аргумента и возвращает её значение.

```python
page_address = ConfigSettings.get_config_value("page_address")
print(page_address)
```

## Пакет ftp_requests:

Этот пакет содержит модули для работы с FTP сервером государственных закупок.

### Файл JSON с директориями для загрузки файлов

Внутри пакета содержится файл `directories.json`, который содержит список директорий на FTP сервере,
из которых необходимо загрузить файлы формата `xml.zip`.
Этот файл используется для определения директорий, из которых нужно загрузить файлы,
и передается соответствующему классу загрузчика FTP.

Пример содержимого `directories.json`:

```json
{
    "0": "/fcs_regions/Adygeja_Resp/contracts/currMonth",
    "1": "/fcs_regions/Altaj_Resp/contracts/currMonth",
    "2": "/fcs_regions/Altajskij_kraj/contracts/currMonth",
    // Другие директории...
}
```

### Модуль config_requests_ftp_44_fz.py

### Класс

```python
FTPClientSettings
```
 Предоставляет базовые настройки для работы с FTP сервером.
 Эти настройки включают в себя адрес сервера, имя пользователя, пароль и порт.
 Параметры задаются статически внутри класса и могут быть использованы в любой части приложения
 для установления соединения с сервером.

Конфигурационные параметры:

- host: Адрес сервера FTP. По умолчанию используется 'ftp.zakupki.gov.ru'.
- username: Имя пользователя для аутентификации. По умолчанию 'free'.
- password: Пароль пользователя для аутентификации. По умолчанию 'free'.
- port: Порт сервера FTP. Значение по умолчанию — 21.

### Методы класса:
Класс имеет два статических метода:

Для получения значений конфигурационных параметров используйте <u>статический метод:</u>

`def get_config_value_ftp_settings(key):`

```python
config_value = FTPClientSettings.get_config_value_ftp_settings('host')
print(config_value)  # Выводит: ftp.zakupki.gov.ru
```

Этот метод принимает ключ конфигурационной переменной в качестве аргумента и возвращает её значение.

Для получения пути к файлу Json используйте <u>статический метод:</u>

`def get_json_file_path():`
```python
# Получение пути к файлу JSON
json_file_path = FTPClientSettings.get_json_file_path()
print(json_file_path)
```


### Модуль ftp_request_44_fz.py

### Класс

```python
class FTPDownloader:
```
Предназначен для скачивания файлов с FTP сервера.
Он автоматически получает настройки для подключения к FTP серверу из класса FTPClientSettings и использует JSON-файл, который содержит список директорий для скачивания файлов. Локальная директория для сохранения файлов также задается в конфигурации приложения с помощью класса ConfigSettings.

Атрибуты класса:
- host: Адрес FTP сервера.
- port: Порт FTP сервера.
- username: Имя пользователя для аутентификации.
- password: Пароль пользователя для аутентификации.
- ftp: Объект FTP соединения.
- json_file_path: Путь к JSON-файлу с директориями для скачивания файлов.
- local_directory: Локальная директория, куда будут сохраняться скачанные файлы.
- date: Начальная дата для фильтрации файлов по дате.


### Методы класса

### Соединение с FTP сервером

Для работы с FTP сервером государственных закупок используется функция `connect()`,
которая находится в модуле, связанном с настройками подключения через FTP.
Эта функция автоматизирует процесс установления соединения с сервером, используя параметры,
заданные в классе `FTPClientSettings`.

```python
def connect(self):
```

### Основные шаги функции `connect()`:

1. **Инициализация соединения**: Создаётся новый экземпляр FTP для начала работы с соединением.
2. **Загрузка настроек**: Функция извлекает необходимые параметры подключения
(адрес сервера, порт, имя пользователя, пароль) из класса `FTPClientSettings`.
3. **Установление соединения**: С использованием извлечённых параметров функция
пытается установить соединение с FTP сервером.
В процессе устанавливается пассивный режим передачи данных.
4. **Аутентификация**: После успешного соединения происходит аутентификация на сервере
с предоставленными учётными данными.
5. **Логирование**: На каждом этапе функции результаты действий записываются в лог,
включая информацию о попытке соединения, установленном соединении или возникшей ошибке.

В случае успешного установления соединения, функция возвращает экземпляр FTP соединения,
который затем может быть использован для дальнейших операций с FTP сервером.
В случае возникновения ошибок при попытке соединения, функция логирует ошибку и возвращает `None`.

Эта функция является ключевым элементом взаимодействия с FTP сервером и обеспечивает надёжную
и удобную интеграцию в общий процесс работы с данными государственных закупок.

### Закрытие соединение с FTP сервером

```python
def close_connection(self):
```

### Скачивание файлов с FTP сервера

```python
download_files_from_directory(self, directory: str) -> List[str]:
```

Этот метод download_files_from_directory предназначен для скачивания файлов из указанной директории
на FTP сервере.
Он переходит в указанную директорию, получает список файлов и рекурсивно обходит все поддиректории
для скачивания файлов из них.

Описание работы функции:
1. Переходит в указанную директорию на FTP сервере.
2. Получает список файлов и поддиректорий в текущей директории.

Для каждого элемента списка:
Если элемент является файлом и соответствует условиям 
(например, имеет нужное расширение и дата создания больше заданной), 
он добавляется в список файлов для скачивания.
Если элемент является директорией, метод рекурсивно вызывает сам себя для скачивания файлов из этой директории.
Скачивает файлы из каждой директории и добавляет их пути в список.
Возвращает список путей к скачанным файлам.
В случае возникновения ошибки при загрузке файлов, метод логирует ошибку и возвращает пустой список.

### TODO--> необходимо дописать, после того, как будет добавлен модуль по работе с базой данных postgreSQL 



Пример использования:
```python
ftp_downloader = FTPDownloader()
ftp_downloader.connect()  # Устанавливаем соединение с FTP сервером
file_paths = ftp_downloader.download_files()  # Скачиваем файлы с FTP сервера
ftp_downloader.close_connection()  # Закрываем соединение
```

## Разработка

### Настройка среды разработки

Для начала работы над проектом установите следующие инструменты...

### Ветвление и слияние

Мы используем Git Flow для организации нашего процесса разработки. Пожалуйста, создавайте ветки для каждой новой функции...

### Кодекс поведения

Участники проекта должны следовать нашему кодексу поведения, который можно найти здесь...

### Тестирование

Для запуска тестов используйте команду...

### Стиль кодирования

Мы следуем стандартам PEP 8 для Python. Убедитесь, что ваш код соответствует этим стандартам...

### Процесс внесения изменений

Прежде чем отправить запрос на слияние, убедитесь, что ваш код прошел все тесты...

### Документация

Документация является важной частью нашего проекта. Пожалуйста, обновляйте документацию в соответствии с вашими изменениями...

### Инструменты и скрипты

Мы используем следующие инструменты для автоматизации нашего процесса разработки...

## Содействие

Как другие пользователи могут помочь в разработке проекта.

## Лицензия

Информация о лицензии, под которой распространяется проект.

## Авторы

Список тех, кто внес вклад в разработку проекта.

## Благодарности

Благодарности тем, кто помогал в разработке.





# FTPClient

## Описание
`FTPClient` - это Python-класс для работы с FTP-серверами. Он предоставляет функциональность для подключения к серверу, передачи файлов и других операций.

## Использование
1. Установите зависимости:
    ```bash
    pip install -r requirements.txt
    #TODO--> необходимо сделать файл с зависимостями и привязать
    #их к определенным версиям для предотвращения сбоев при работе с
    #программой
    ```

2. Импортируйте класс `FTPClient` в свой код:
    ```python
    from ftp_client import FTPClient
    ```

3. Создайте экземпляр класса, передав параметры подключения:
    ```python
    host = "ftp.example.com"
    username = "myuser"
    password = "mypassword"
    ftp_client = FTPClient(host, username, password)
    ```

4. Выполните необходимые операции:
    - Подключение к серверу:
        ```python
        ftp_client.connect()
        ```

    - Загрузка файла на сервер:
        ```python
        local_file_path = "local_file.txt"
        remote_file_path = "remote_file.txt"
        ftp_client.upload_file(local_file_path, remote_file_path)
        ```

    - Закрытие соединения:
        ```python
        ftp_client.close()
        ```

## Логирование
Логирование событий осуществляется с помощью модуля `logging`. Журнал событий можно настроить в файле `custom_logger.py`.

## Примечание
Не забудьте заменить значения `host`, `username` и `password` на реальные данные для вашего FTP-сервера.

